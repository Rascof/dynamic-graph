<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>dynamic-graph: Debugging with macros and level</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="sot.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="MathJax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dynamic-graph
   &#160;<span id="projectnumber">4.1.0-8-gdab7-dirty</span>
   </div>
   <div id="projectbrief">Dynamic graph library</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('subp_dbg_trace.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Debugging with macros and level </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="subp_dbg_trace_intro"></a>
Introduction</h1>
<p>The idea of this class and collection of MACROS is to specify a level for a message, and record the message in a stream according to this level. In addition there are mechanisms allowing that no time is wasted in condition test. You can therefore let the debugging messages inside the code without impact on performances.</p>
<h1><a class="anchor" id="subp_dbg_trace_set_on_macros"></a>
Setting up dgDEBUG macros</h1>
<p>To allow message display the entity must be compiled with the macro </p><div class="fragment"><div class="line"><span class="preprocessor">#define VP_DEBUG 1</span></div></div><!-- fragment --><p> Commenting or removing this macro disable all the messages specified by the following macros.</p>
<p>The level up to which the messages are accepted for display is specified by: </p><div class="fragment"><div class="line"><span class="preprocessor">#define VP_DEBUG_MODE 50</span></div></div><!-- fragment --><p>In the constructor of the entity, the file where all the messages are written is specified by: </p><div class="fragment"><div class="line">dynamicgraph::dgDEBUGFLOW.openFile(<span class="stringliteral">&quot;/tmp/dynamic-graph-traces.txt&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="subp_dbg_trace_using_macros"></a>
Using dgDEBUG macros</h1>
<p>To print that the beginning of a method is being executed use the following macros:</p><div class="fragment"><div class="line">dgDEBUGIN(5); </div></div><!-- fragment --><p> 5 here specifies the minimum level that you be specified by VP_DEBUG_MODE for this message to be displayed.</p>
<p>It will generate the following output: </p><div class="fragment"><div class="line">/path_to/dynamic-graph/tests/debug-trace.cpp: testDebugTrace(#46) :# In {</div></div><!-- fragment --><p> The output displays the name of the source file, the name of the method, the line where is the macro, and the message itself.</p>
<p>When going out of the method: </p><div class="fragment"><div class="line">dgDEBUGOUT(5);</div></div><!-- fragment --><p>This generates the following output: </p><div class="fragment"><div class="line">/path_to/dynamic-graph/tests/debug-trace.cpp: testDebugTrace(#54) :# Out }</div></div><!-- fragment --><p>A message inside the code is written through: </p><div class="fragment"><div class="line">dgDEBUG(5) &lt;&lt; <span class="stringliteral">&quot;Here is a test&quot;</span> &lt;&lt; std::endl;</div></div><!-- fragment --><p>This generates the following output: </p><div class="fragment"><div class="line">/path_to/dynamic-graph/tests/debug-trace.cpp: testDebugTrace(#52) :Here is a</div><div class="line">test </div></div><!-- fragment --><h1><a class="anchor" id="subp_dbg_trace_wrk_exp"></a>
Working example</h1>
<p>A full working example is given here: </p><div class="fragment"><div class="line"><span class="comment">/* Copyright 2019, LAAS-CNRS</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Olivier Stasse</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;dynamic-graph/factory.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;dynamic-graph/pool.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;dynamic-graph/entity.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;dynamic-graph/exception-factory.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VP_DEBUG 1</span></div><div class="line"><span class="preprocessor">#define VP_DEBUG_MODE 50</span></div><div class="line"><span class="preprocessor">#define VP_TEMPLATE_DEBUG_MODE 50</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;dynamic-graph/debug.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define BOOST_TEST_MODULE debug - trace</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;boost/test/output_test_stream.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;boost/test/unit_test.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> boost::test_tools::output_test_stream;</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacedynamicgraph.html">dynamicgraph</a> {</div><div class="line"><span class="keyword">class </span>CustomEntity : <span class="keyword">public</span> Entity {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> std::string CLASS_NAME;</div><div class="line">  <span class="keyword">virtual</span> <span class="keyword">const</span> std::string &amp;getClassName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CLASS_NAME; }</div><div class="line">  <span class="keyword">explicit</span> CustomEntity(<span class="keyword">const</span> std::string &amp;n) : Entity(n) {</div><div class="line">    dynamicgraph::dgDEBUGFLOW.openFile(<span class="stringliteral">&quot;/tmp/dynamic-graph-traces.txt&quot;</span>);</div><div class="line">  }</div><div class="line">  ~CustomEntity() {</div><div class="line">    dynamicgraph::dgDEBUGFLOW.closeFile(<span class="stringliteral">&quot;/tmp/dynamic-graph-traces.txt&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordtype">void</span> testDebugTrace() {</div><div class="line">    dgDEBUGIN(5);</div><div class="line"></div><div class="line">    dgDEBUGINOUT(5);</div><div class="line"></div><div class="line">    dgDEBUG(5) &lt;&lt; <span class="stringliteral">&quot;Here is a test&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    dgDEBUGOUT(5);</div><div class="line">  }</div><div class="line">};</div><div class="line"><a class="code" href="group__dgraph.html#ga85cdc78c7d7456c08cc56b701770542d">DYNAMICGRAPH_FACTORY_ENTITY_PLUGIN</a>(CustomEntity, <span class="stringliteral">&quot;CustomEntity&quot;</span>);</div><div class="line">} <span class="comment">// namespace dynamicgraph</span></div><div class="line"></div><div class="line">BOOST_AUTO_TEST_CASE(testDebugTrace) {</div><div class="line">  BOOST_CHECK_EQUAL(dynamicgraph::CustomEntity::CLASS_NAME, <span class="stringliteral">&quot;CustomEntity&quot;</span>);</div><div class="line"></div><div class="line">  dynamicgraph::CustomEntity *ptr_entity =</div><div class="line">      (<span class="keyword">dynamic_cast&lt;</span>dynamicgraph::CustomEntity *<span class="keyword">&gt;</span>(</div><div class="line">          <a class="code" href="classdynamicgraph_1_1FactoryStorage.html#a8fe84181939beb06aa0ee186d9a043e8">dynamicgraph::FactoryStorage::getInstance</a>()-&gt;<a class="code" href="classdynamicgraph_1_1FactoryStorage.html#aa97e6f7ecc462042756649acc73d9d77">newEntity</a>(<span class="stringliteral">&quot;CustomEntity&quot;</span>,</div><div class="line"></div><div class="line">                                                                 <span class="stringliteral">&quot;my-entity&quot;</span>)));</div><div class="line"></div><div class="line">  dynamicgraph::CustomEntity &amp;entity = *ptr_entity;</div><div class="line">  entity.testDebugTrace();</div><div class="line"></div><div class="line">  output_test_stream output;</div><div class="line">  std::fstream the_debug_file;</div><div class="line">  the_debug_file.open(dynamicgraph::DebugTrace::DEBUG_FILENAME_DEFAULT,</div><div class="line">                      std::ios::in);</div><div class="line"></div><div class="line">  <span class="comment">// Extract the filename and this source file from the output</span></div><div class="line">  std::string astr;</div><div class="line">  std::ostringstream oss_debug_file;</div><div class="line">  <span class="keywordflow">while</span> (std::getline(the_debug_file, astr)) {</div><div class="line">    std::size_t found = astr.find(<span class="stringliteral">&quot;:&quot;</span>);</div><div class="line">    std::string asubstr = astr.substr(found + 1, astr.length());</div><div class="line">    found = asubstr.find(<span class="stringliteral">&quot;:&quot;</span>);</div><div class="line">    std::string asubstr2 = asubstr.substr(found + 1, astr.length());</div><div class="line">    oss_debug_file &lt;&lt; asubstr2;</div><div class="line">  }</div><div class="line"></div><div class="line">  the_debug_file.close();</div><div class="line"></div><div class="line">  <span class="comment">// Compare with the strings put inside this source file</span></div><div class="line">  std::string str_to_test = <span class="stringliteral">&quot;# In {&quot;</span></div><div class="line">                            <span class="stringliteral">&quot;# In/Out { }&quot;</span></div><div class="line">                            <span class="stringliteral">&quot;Here is a test&quot;</span></div><div class="line">                            <span class="stringliteral">&quot;# Out }&quot;</span>;</div><div class="line">  <span class="keywordtype">bool</span> two_sub_string_identical;</div><div class="line"></div><div class="line">  <span class="comment">// Make comparisons.</span></div><div class="line">  two_sub_string_identical = str_to_test == oss_debug_file.str();</div><div class="line"></div><div class="line">  BOOST_CHECK(two_sub_string_identical);</div><div class="line"></div><div class="line">  <span class="keyword">delete</span> ptr_entity;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
